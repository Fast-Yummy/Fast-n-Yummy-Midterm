<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Styles</title>
    <% include partials/_styles %>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <% include partials/_header %>

    <main class="container">
      <div>
        <h2>Thank You for your order. Your order is now confirmed!</h2>
        <h3>Order Number: <b><%=orderid%></b> </h3><br />
        <h2 id="order-text">Your food will be ready in: <p id="timer"></p> </h2>
      </div>
      </main>
    <footer class="footer">
     <% include partials/_footer %>
    </footer>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>

    <script>

        // Set the date we are counting down to
          var time =  "totalTime";
          url = window.location.href;
          time = time.replace(/[\[\]]/g, '\\$&');
          var regex = new RegExp('[?&]' + time + '(=([^&#]*)|&|#|$)'),
            output = regex.exec(url);
          if (!output) output ===  null;
          if (!output[2]) output === '';
          output = decodeURIComponent(output[2].replace(/\+/g, ' '));

      var totalTime = output;
      var countDownDate = new Date().getTime() + totalTime * 60000;

      // Update the count down every 1 second
      var x = setInterval(function() {
        // Get todays date and time
        var now = new Date().getTime();
        // Find the distance between now and the count down date
        var distance = countDownDate - now;
        // Time calculations for days, hours, minutes and seconds
        var days = Math.floor(distance / (1000 * 60 * 60 * 24));
        var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        var seconds = Math.floor((distance % (1000 * 60)) / 1000);
        // Display the result in the element with id="demo"
        document.getElementById("timer").innerHTML = minutes + " min(s) " + seconds + " sec(s)";

        // If the count down is finished, write some text 
        if (distance < 0) {
          clearInterval(x);
          const orderid = $("#sessionID").data("orderid");
          var name =  "phoneNumber";
          url2 = window.location.href;
          name = name.replace(/[\[\]]/g, '\\$&');
          var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url2);
          if (!results) output === null;
          if (!results[2]) output === '';
          results = decodeURIComponent(results[2].replace(/\+/g, ' '));
          phonenbr = results;
          $.ajax("/status", {
            method: 'POST',
            data : {orderid :orderid, phonenbr: phonenbr}
            })

          .then(function(data){
            
          })
          document.getElementById("order-text").innerHTML = "Your order is ready!!";
          document.getElementById("timer").innerHTML = "";
          };
      }, 1000);

    </script>
  </body>
</html>


